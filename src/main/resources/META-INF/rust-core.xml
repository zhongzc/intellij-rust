<idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude" allow-bundled-update="true">
    <resource-bundle>messages.RsBundle</resource-bundle>

    <depends>com.intellij.modules.lang</depends>

    <xi:include href="/META-INF/platform-core.xml" xpointer="xpointer(/idea-plugin/*)"/>
    <xi:include href="/META-INF/experiments.xml" xpointer="xpointer(/idea-plugin/*)"/>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Rust -->

        <!-- Modules -->
        <!-- although Rust module type is only created by IDEA, we need it in other IDEs as well
        to be able to open a project created in IDEA without errors -->
        <moduleType id="RUST_MODULE" implementationClass="org.rust.ide.module.RsModuleType"/>
        <moduleBuilder builderClass="org.rust.ide.module.RsModuleBuilder"/>

        <!-- Project Creation -->
        <projectOpenProcessor id="Cargo" implementation="org.rust.cargo.project.CargoProjectOpenProcessor"/>
        <directoryProjectGenerator implementation="org.rust.ide.newProject.RsDirectoryProjectGenerator"/>
        <applicationService serviceImplementation="org.rust.ide.newProject.state.RsUserTemplatesState"/>

        <!-- File-type Factory -->

        <fileType name="Rust"
                  language="Rust"
                  implementationClass="org.rust.lang.RsFileType"
                  extensions="rs"
                  fieldName="INSTANCE"/>
        <internalFileTemplate name="Rust File"/>

        <!-- Parser -->

        <lang.parserDefinition language="Rust" implementationClass="org.rust.lang.core.parser.RustParserDefinition"/>
        <stubElementTypeHolder class="org.rust.lang.core.psi.RsElementTypes"/>
        <lang.ast.factory language="Rust" implementationClass="org.rust.lang.core.RsASTFactory"/>

        <!-- Sources -->

        <generatedSourcesFilter implementation="org.rust.cargo.project.model.RsGeneratedSourcesFilter"/>
        <writingAccessProvider implementation="org.rust.cargo.project.model.RsGeneratedSourcesWritingAccessProvider"/>

        <!-- PSI managing -->

        <projectService serviceInterface="org.rust.lang.core.psi.RsPsiManager"
                        serviceImplementation="org.rust.lang.core.psi.RsPsiManagerImpl"/>

        <!-- Code insight settings -->

        <applicationService serviceImplementation="org.rust.ide.settings.RsCodeInsightSettings"/>
        <editorActionHandler action="EditorEnter" implementationClass="org.rust.ide.actions.RsEnterHandler"/>

        <applicationService serviceImplementation="org.rust.cargo.runconfig.RsRunConfigurationExtensionManager"/>

        <!-- Selection Handler -->

        <extendWordSelectionHandler implementation="org.rust.ide.wordSelection.RsStringLiteralSelectionHandler"/>
        <extendWordSelectionHandler implementation="org.rust.ide.wordSelection.RsBlockSelectionHandler"/>
        <extendWordSelectionHandler implementation="org.rust.ide.wordSelection.RsGroupSelectionHandler"/>
        <extendWordSelectionHandler implementation="org.rust.ide.wordSelection.RsFieldLikeSelectionHandler"/>
        <extendWordSelectionHandler implementation="org.rust.ide.wordSelection.RsListSelectionHandler"/>
        <extendWordSelectionHandler implementation="org.rust.ide.wordSelection.RsMacroCallSelectionHandler"/>

        <!-- Syntax Highlighter -->

        <lang.syntaxHighlighter language="Rust"
                                implementationClass="org.rust.ide.highlight.RsHighlighter"/>
        <highlightUsagesHandlerFactory implementation="org.rust.ide.highlight.RsHighlightExitPointsHandlerFactory"/>

        <!-- Formatter -->

        <!--suppress PluginXmlValidity -->
        <externalFormatProcessor implementation="org.rust.ide.formatter.RustfmtExternalFormatProcessor"/>
        <lang.formatter language="Rust" implementationClass="org.rust.ide.formatter.RsFormattingModelBuilder"/>
        <preFormatProcessor implementation="org.rust.ide.formatter.processors.RsMatchArmCommaFormatProcessor"/>
        <preFormatProcessor implementation="org.rust.ide.formatter.processors.RsStatementSemicolonFormatProcessor"/>
        <postFormatProcessor implementation="org.rust.ide.formatter.processors.RsPostFormatProcessor"/>
        <!-- Please ADD NO MORE `PostFormatProcessor`s! Follow `RsTrailingCommaFormatProcessor` design if needed -->

        <!-- Refactoring support -->

        <lang.refactoringSupport language="Rust"
                                 implementationClass="org.rust.ide.refactoring.RsRefactoringSupportProvider"/>
        <suggestedRefactoringSupport language="Rust" implementationClass="org.rust.ide.refactoring.suggested.RsSuggestedRefactoringSupport"/>

        <refactoring.changeSignatureUsageProcessor implementation="org.rust.ide.refactoring.changeSignature.RsChangeSignatureUsageProcessor"
                                                   id="Rust"/>

        <!-- Commenter -->

        <lang.commenter language="Rust" implementationClass="org.rust.ide.commenter.RsCommenter"/>

        <!-- Matchers -->

        <lang.braceMatcher language="Rust" implementationClass="org.rust.ide.typing.RsBraceMatcher"/>
        <lang.quoteHandler language="Rust" implementationClass="org.rust.ide.typing.RsQuoteHandler"/>

        <!-- Doc-Provider -->

        <lang.documentationProvider language="Rust" implementationClass="org.rust.ide.docs.RsDocumentationProvider"/>

        <lang.implementationTextSelectioner language="Rust"
                                            implementationClass="org.rust.ide.hints.RsImplementationTextSelectioner"/>

        <!-- Filters -->

        <analyzeStacktraceFilter implementation="org.rust.cargo.runconfig.filters.RsBacktraceFilter"/>

        <!-- Structure View -->

        <lang.psiStructureViewFactory language="Rust"
                                      implementationClass="org.rust.ide.structure.RsPsiStructureViewFactory"/>

        <treeStructureProvider implementation="org.rust.ide.projectView.RsTreeStructureProvider"/>

        <!-- Usages Provider -->

        <lang.findUsagesProvider language="Rust" implementationClass="org.rust.ide.search.RsFindUsagesProvider"/>
        <findUsagesHandlerFactory implementation="org.rust.ide.search.RsFindUsagesHandlerFactory"/>
        <usageTypeProvider implementation="org.rust.ide.search.RsUsageTypeProvider"/>
        <readWriteAccessDetector implementation="org.rust.ide.search.RsReadWriteAccessDetector" id="rust"/>
        <importFilteringRule implementation="org.rust.ide.search.RsImportFilteringRule"/>
        <fileStructureGroupRuleProvider implementation="org.rust.ide.search.RsFunctionGroupingRuleProvider"
                                        id="rs-function"/>
        <fileStructureGroupRuleProvider implementation="org.rust.ide.search.RsTraitOrImplGroupingRuleProvider"
                                        order="before rs-function"/>

        <!-- Todos -->

        <indexPatternBuilder implementation="org.rust.ide.todo.RsTodoIndexPatternBuilder"/>
        <todoIndexer filetype="Rust" implementationClass="org.rust.ide.todo.RsTodoIndexer"/>
        <indexPatternSearch
            id="RsTodoSearcher"
            implementation="org.rust.ide.todo.RsTodoSearcher"/>

        <!-- Smart Enter Processor -->

        <lang.smartEnterProcessor language="Rust"
                                  implementationClass="org.rust.ide.typing.assist.RsSmartEnterProcessor"/>

        <!-- Imports -->

        <lang.importOptimizer language="Rust" implementationClass="org.rust.ide.refactoring.RsImportOptimizer"/>
        <autoImportOptionsProvider instance="org.rust.ide.settings.RsAutoImportOptions"/>

        <!-- Navigation -->

        <gotoClassContributor implementation="org.rust.ide.navigation.goto.RsClassNavigationContributor"/>
        <gotoSymbolContributor implementation="org.rust.ide.navigation.goto.RsSymbolNavigationContributor"/>
        <codeInsight.gotoSuper language="Rust" implementationClass="org.rust.ide.navigation.goto.RsGotoSuperHandler"/>
        // `ctrl+alt+b`
        <definitionsScopedSearch implementation="org.rust.ide.navigation.goto.RsImplsSearch"/>
        <gotoTargetRendererProvider implementation="org.rust.ide.navigation.goto.RsGotoTargetRendererProvider"/>
        // `ctrl+shift+b`
        <typeDeclarationProvider implementation="org.rust.ide.navigation.goto.RsTypeDeclarationProvider"/>

        <targetElementEvaluator language="Rust"
                                implementationClass="org.rust.ide.navigation.goto.RsTargetElementEvaluator"/>

        <!-- Focus mode -->
        <focusModeProvider language="Rust" implementationClass="org.rust.ide.focusMode.RsFocusModeProvider"/>

        <!-- Hints -->

        <codeInsight.typeInfo language="Rust" implementationClass="org.rust.ide.hints.type.RsExpressionTypeProvider"/>
        <codeInsight.parameterInfo language="Rust" implementationClass="org.rust.ide.hints.parameter.RsParameterInfoHandler"/>
        <codeInsight.parameterInfo language="Rust"
                                   implementationClass="org.rust.ide.hints.parameter.RsGenericParameterInfoHandler"/>
        <codeInsight.parameterNameHints language="Rust"
                                        implementationClass="org.rust.ide.hints.parameter.RsInlayParameterHintsProvider"/>
        <codeInsight.inlayProvider language="Rust" implementationClass="org.rust.ide.hints.type.RsInlayTypeHintsProvider"/>
        <codeInsight.inlayProvider language="Rust" implementationClass="org.rust.ide.hints.type.RsChainMethodTypeHintsProvider"/>

        <declarationRangeHandler key="org.rust.lang.core.psi.RsStructItem"
                                 implementationClass="org.rust.ide.hints.RsStructItemDeclarationRangeHandler"/>
        <declarationRangeHandler key="org.rust.lang.core.psi.RsTraitItem"
                                 implementationClass="org.rust.ide.hints.RsTraitItemDeclarationRangeHandler"/>
        <declarationRangeHandler key="org.rust.lang.core.psi.RsImplItem"
                                 implementationClass="org.rust.ide.hints.RsImplItemDeclarationRangeHandler"/>
        <declarationRangeHandler key="org.rust.lang.core.psi.RsEnumItem"
                                 implementationClass="org.rust.ide.hints.RsEnumItemDeclarationRangeHandler"/>
        <declarationRangeHandler key="org.rust.lang.core.psi.RsModItem"
                                 implementationClass="org.rust.ide.hints.RsModItemDeclarationRangeHandler"/>
        <declarationRangeHandler key="org.rust.lang.core.psi.RsFunction"
                                 implementationClass="org.rust.ide.hints.RsFunctionDeclarationRangeHandler"/>
        <declarationRangeHandler key="org.rust.lang.core.psi.RsMacro"
                                 implementationClass="org.rust.ide.hints.RsMacroDeclarationRangeHandler"/>

        <!-- Annotator -->

        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsDoctestAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsSyntaxErrorsAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsEdition2018KeywordsAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsLiteralAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsFormatMacroAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsHighlightingAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsHighlightingMutableAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsExpressionAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsErrorAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsUnsafeExpressionAnnotator"/>
        <annotator language="Rust" implementationClass="org.rust.ide.annotator.RsCfgDisabledCodeAnnotator"/>
        <highlightRangeExtension implementation="org.rust.ide.annotator.RsErrorAnnotator"/>

        <highlightingPassFactory implementation="org.rust.ide.annotator.RsHighlightingPassFactoryRegistrar"/>

        <!-- Line Marker Providers -->

        <codeInsight.lineMarkerProvider language="Rust"
                                        implementationClass="org.rust.ide.lineMarkers.RsImplsLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="Rust"
                                        implementationClass="org.rust.ide.lineMarkers.RsRecursiveCallLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="Rust"
                                        implementationClass="org.rust.ide.lineMarkers.RsTraitItemImplLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="Rust"
                                        implementationClass="org.rust.ide.lineMarkers.RsCrateDocLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider language="Rust"
                                        implementationClass="org.rust.ide.lineMarkers.RsMethodLineSeparatorProvider"/>

        <runLineMarkerContributor language="Rust"
                                  implementationClass="org.rust.ide.lineMarkers.CargoExecutableRunLineMarkerContributor"/>
        <runLineMarkerContributor language="Rust"
                                  implementationClass="org.rust.ide.lineMarkers.CargoTestRunLineMarkerContributor"/>

        <!-- Rename Processor -->

        <renamePsiElementProcessor implementation="org.rust.ide.refactoring.RsRenameProcessor" order="first"
                                   id="rsRenameProcessor"/>
        <renamePsiElementProcessor implementation="org.rust.ide.refactoring.RsDirectoryRenameProcessor"
                                   order="first, before rsRenameProcessor"/>

        <!-- Implement methods -->

        <codeInsight.implementMethod language="Rust"
                                     implementationClass="org.rust.ide.refactoring.implementMembers.ImplementMembersHandler"/>

        <!-- Resolve -->

        <psi.referenceContributor language="Rust"
                                  implementation="org.rust.lang.core.resolve.ref.RsLitExprReferenceContributor"/>
        <referencesSearch implementation="org.rust.lang.core.resolve.ref.RsReferencesSearchExtensionImpl"/>

        <!-- Completion -->

        <codeCompletionConfigurable instance="org.rust.ide.settings.RsCodeCompletionConfigurable"/>

        <completion.contributor language="Rust"
                                implementationClass="org.rust.lang.core.completion.RsCompletionContributor"/>
        <completion.contributor language="Rust"
                                implementationClass="org.rust.lang.core.completion.RsKeywordCompletionContributor"/>

        <!-- Description Provider -->

        <elementDescriptionProvider implementation="org.rust.ide.presentation.RsDescriptionProvider"/>
        <breadcrumbsInfoProvider implementation="org.rust.ide.miscExtensions.RsBreadcrumbsInfoProvider"/>

        <!-- Spell-checker -->

        <spellchecker.support language="Rust" implementationClass="org.rust.ide.spelling.RsSpellcheckingStrategy"/>
        <spellchecker.bundledDictionaryProvider implementation="org.rust.ide.spelling.RsBundledDictionaryProvider"/>

        <!-- Handlers -->

        <enterHandlerDelegate implementation="org.rust.ide.typing.RsEnterInLineCommentHandler"
                              id="RustEnterInLineComments"/>

        <enterHandlerDelegate implementation="org.rust.ide.typing.RsEnterInStringLiteralHandler"
                              id="RustEnterInStringLiterals"/>

        <enterBetweenBracesDelegate language="Rust"
                                    implementationClass="com.intellij.codeInsight.editorActions.enter.EnterBetweenBracesAndBracketsDelegate"/>

        <typedHandler implementation="org.rust.ide.typing.RsRawLiteralHashesInserter"
                      id="RsRawLiteralHashesInserter"/>
        <typedHandler implementation="org.rust.ide.typing.RsAngleBraceTypedHandler"
                      id="RsAngleBraceTypedHandler"/>
        <typedHandler implementation="org.rust.ide.typing.RsDotTypedHandler"
                      id="RsDotTypedHandler"/>

        <backspaceHandlerDelegate implementation="org.rust.ide.typing.RsRawLiteralHashesDeleter"
                                  id="RsRawLiteralHashesDeleter"/>
        <backspaceHandlerDelegate implementation="org.rust.ide.typing.RsAngleBraceBackspaceHandler"
                                  id="RsAngleBraceBackspaceHandler"/>

        <joinLinesHandler implementation="org.rust.ide.actions.RsJoinLinesHandler"
                          id="RsJoinLinesHandler"/>

        <joinLinesHandler implementation="org.rust.ide.actions.RsJoinRawLinesHandler"
                          id="RsJoinRawLinesHandler"/>

        <!-- Code Style -->

        <langCodeStyleSettingsProvider
                implementation="org.rust.ide.formatter.settings.RsLanguageCodeStyleSettingsProvider"/>

        <!-- Color Settings -->

        <colorSettingsPage implementation="org.rust.ide.colors.RsColorSettingsPage"/>

        <additionalTextAttributes scheme="Default" file="org/rust/ide/colors/RustDefault.xml"/>
        <additionalTextAttributes scheme="Darcula" file="org/rust/ide/colors/RustDarcula.xml"/>

        <!-- Inspections -->

        <lang.inspectionSuppressor language="Rust"
                                   implementationClass="org.rust.ide.inspections.RsInspectionSuppressor"/>

        <localInspection language="Rust" groupPath="Rust" groupName="Lints"
                         displayName="Implicit trait objects are deprecated"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsBareTraitObjectsInspection"/>

        <localInspection language="Rust" groupPath="Rust" groupName="Lints"
                         displayName="Deprecated element"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsDeprecationInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Approximate Constants"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsApproxConstantInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Unsafe CString pointer"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsCStringPointerInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Unresolved reference"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsUnresolvedReferenceInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Double negation"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsDoubleNegInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Suspicious assignment"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsSuspiciousAssignmentInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Dangling else"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsDanglingElseInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Missing else"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsMissingElseInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Redundant else"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsRedundantElseInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Dropping reference"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsDropRefInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Argument naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsArgumentNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Associated type naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsAssocTypeNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Constant naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsConstNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Enum naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsEnumNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Enum variant naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsEnumVariantNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Function naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsFunctionNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Lifetime naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsLifetimeNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Macro naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsMacroNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Method naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsMethodNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Module naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsModuleNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Static constant naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsStaticConstNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Self convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsSelfConventionInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Struct naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsStructNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Field naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsFieldNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Trait naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsTraitNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Type alias naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsTypeAliasNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Type parameter naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsTypeParameterNamingInspection"/>

        <localInspection language="Rust" groupPath="Rust,Lints" groupName="Naming conventions"
                         displayName="Variable naming convention"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsVariableNamingInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Extra semicolon"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsExtraSemicolonInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="try! macro usage"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.RsTryMacroInspection"/>

        <localInspection language="Rust" groupPath="Rust" groupName="Lints"
                         displayName="While true loop"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsWhileTrueLoopInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="println!(&quot;&quot;) usage"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.RsSimplifyPrintInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Simplify boolean expression"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsSimplifyBooleanExpressionInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="No mutable required"
                         enabledByDefault="false" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsVariableMutableInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Wrong generic arguments number"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsWrongGenericArgumentsNumberInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Wrong lifetime parameters number"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsWrongLifetimeParametersNumberInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Re-assign immutable variable"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsReassignImmutableInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Borrow checker"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsBorrowCheckerInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Field initialization shorthand"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.RsFieldInitShorthandInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Assert Equal"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.RsAssertEqualInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Experimental checks"
                         enabledByDefault="false" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsExperimentalChecksInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Type checker"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsTypeCheckInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Different impl member order from the trait"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.RsSortImplTraitMembersInspection"/>

        <localInspection language="Rust" groupPath="Rust" groupName="Lints"
                         displayName="Needless lifetimes"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsNeedlessLifetimesInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Assign to immutable"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsAssignToImmutableInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Trait implementation"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsTraitImplementationInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Cast to bool"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsCastToBoolInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Attribute without parentheses"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsAttrWithoutParenthesesInspection"/>

        <localInspection language="Rust" groupPath="Rust" groupName="Lints"
                         displayName="Unreachable patterns"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.checkMatch.RsUnreachablePatternsInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Non-exhaustive match"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.checkMatch.RsNonExhaustiveMatchInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Return can be lifted out"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.RsLiftInspection"/>

        <globalInspection language="Rust" groupName="Rust"
                          displayName="External Linter"
                          enabledByDefault="true" level="ERROR"
                          implementationClass="org.rust.ide.inspections.RsExternalLinterInspection"/>

        <localInspection language="Rust" groupPath="Rust" groupName="Lints"
                         displayName="Liveness analysis"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsLivenessInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Main function not found"
                         enabledByDefault="true" level="ERROR"
                         implementationClass="org.rust.ide.inspections.RsMainFunctionNotFoundInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Detached file"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.RsDetachedFileInspection"/>

        <localInspection language="Rust" groupName="Rust"
                         displayName="Duplicate trait method parameter name"
                         enabledByDefault="true" level="WEAK WARNING"
                         implementationClass="org.rust.ide.inspections.RsDuplicatedTraitMethodBindingInspection"/>

        <localInspection language="Rust" groupPath="Rust" groupName="Lints"
                         displayName="Unreachable code"
                         enabledByDefault="true" level="WARNING"
                         implementationClass="org.rust.ide.inspections.lints.RsUnreachableCodeInspection"/>

        <!-- Surrounders -->

        <lang.surroundDescriptor language="Rust"
                                 implementationClass="org.rust.ide.surroundWith.expression.RsExpressionSurroundDescriptor"/>
        <lang.surroundDescriptor language="Rust"
                                 implementationClass="org.rust.ide.surroundWith.statement.RsStatementsSurroundDescriptor"/>

        <!-- Folding -->

        <lang.foldingBuilder language="Rust" implementationClass="org.rust.ide.folding.RsFoldingBuilder"/>
        <codeFoldingOptionsProvider instance="org.rust.ide.folding.RsCodeFoldingOptionsProvider"/>
        <applicationService serviceInterface="org.rust.ide.folding.RsCodeFoldingSettings"
                            serviceImplementation="org.rust.ide.folding.impl.RsCodeFoldingSettingsImpl"/>

        <!-- Live Templates -->

        <defaultLiveTemplates file="org/rust/ide/liveTemplates/iterations"/>
        <defaultLiveTemplates file="org/rust/ide/liveTemplates/output"/>
        <defaultLiveTemplates file="org/rust/ide/liveTemplates/test"/>
        <defaultLiveTemplates file="org/rust/ide/liveTemplates/other"/>

        <liveTemplateContext implementation="org.rust.ide.template.RsContextType$Generic"/>
        <liveTemplateContext implementation="org.rust.ide.template.RsContextType$Statement"/>
        <liveTemplateContext implementation="org.rust.ide.template.RsContextType$Item"/>
        <liveTemplateContext implementation="org.rust.ide.template.RsContextType$Struct"/>
        <liveTemplateContext implementation="org.rust.ide.template.RsContextType$Mod"/>
        <liveTemplateContext implementation="org.rust.ide.template.RsContextType$Attribute"/>

        <liveTemplateMacro implementation="org.rust.ide.template.macros.RsSuggestIndexNameMacro"/>
        <liveTemplateMacro implementation="org.rust.ide.template.macros.RsCollectionElementNameMacro"/>

        <!-- Intentions -->

        <intentionAction>
            <className>org.rust.ide.intentions.ImplTraitToTypeParamIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ExtractInlineModuleIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddDeriveIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.RemoveCurlyBracesIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ReplaceLineCommentWithBlockCommentIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ReplaceBlockCommentWithLineCommentIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddCurlyBracesIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.RemoveDbgIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.WrapLambdaExprIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.UnwrapSingleExprIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.DemorgansLawIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.SimplifyBooleanExpressionIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.UnwrapToMatchIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.UnwrapToTryIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddElseIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.MoveTypeConstraintToWhereClauseIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.MatchToIfLetIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.MoveGuardToMatchArmIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.SetMutableIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.SetImmutableIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddImplIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.UnElideLifetimesIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.IfLetToMatchIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.SpecifyTypeExplicitlyIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ToggleIgnoreTestIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.MoveTypeConstraintToParameterListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.FlipBinaryExpressionIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.SplitIfIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.RsShowRecursiveMacroExpansionIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.RsShowSingleStepMacroExpansionIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.RunCargoExpandIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.NestUseStatementsIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.FlattenUseStatementsIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ChopParameterListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.JoinParameterListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ChopArgumentListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.JoinArgumentListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ChopFieldListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.JoinFieldListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ChopLiteralFieldListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.JoinLiteralFieldListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ChopVariantListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.JoinVariantListIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.InvertIfIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.DestructureIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.addFmtStringArgument.AddFmtStringArgumentIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ConvertToStructIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ConvertToTupleIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddStructFieldsPatIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddStructFieldsLiteralIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddStructFieldsLiteralRecursiveIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ExtractEnumVariantIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.IntroduceLocalVariableIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ConvertUFCSToMethodCallIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.ConvertMethodCallToUFCSIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddImportIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.SubstituteAssociatedTypeIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.CreateFunctionIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddRemainingArmsIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.AddWildcardArmIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.visibility.MakePubIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.visibility.MakePubCrateIntention</className>
            <category>Rust</category>
        </intentionAction>
        <intentionAction>
            <className>org.rust.ide.intentions.visibility.MakePrivateIntention</className>
            <category>Rust</category>
        </intentionAction>

        <!-- Run Configurations -->

        <programRunner implementation="org.rust.cargo.runconfig.CargoCommandRunner"/>
        <programRunner implementation="org.rust.cargo.runconfig.CargoTestCommandRunner"/>
        <programRunner implementation="org.rust.debugger.runconfig.RsDebugAdvertisingRunner"/>
        <programRunner implementation="org.rust.cargo.runconfig.wasmpack.WasmPackCommandRunner"/>

        <configurationType implementation="org.rust.cargo.runconfig.command.CargoCommandConfigurationType"/>
        <configurationType implementation="org.rust.cargo.runconfig.wasmpack.WasmPackCommandConfigurationType"/>

        <runConfigurationProducer
                implementation="org.rust.cargo.runconfig.command.CompositeCargoRunConfigurationProducer"/>
        <!-- To register a new producer, add it to the `producers` list in the `CompositeCargoRunConfigurationProducer`
             producer instead of registering it here. -->

        <stepsBeforeRunProvider implementation="org.rust.cargo.runconfig.buildtool.CargoBuildTaskProvider"/>
        <stepsBeforeRunProvider implementation="org.rust.cargo.runconfig.wasmpack.WasmPackBuildTaskProvider"/>

        <projectTaskRunner implementation="org.rust.cargo.runconfig.buildtool.CargoBuildTaskRunner"/>

        <!-- Cargo -->

        <projectConfigurable instance="org.rust.cargo.project.configurable.RsProjectConfigurable"
                             displayName="Rust"
                             groupId="language"
                             id="language.rust"/>

        <projectConfigurable instance="org.rust.cargo.project.configurable.CargoConfigurable"
                             displayName="Cargo"
                             parentId="language.rust"
                             id="language.rust.cargo"/>

        <projectConfigurable instance="org.rust.cargo.project.configurable.RustfmtConfigurable"
                             displayName="Rustfmt"
                             parentId="language.rust"
                             id="language.rust.rustfmt"/>

        <projectService serviceInterface="org.rust.cargo.project.settings.RustProjectSettingsService"
                        serviceImplementation="org.rust.cargo.project.settings.impl.RustProjectSettingsServiceImpl"/>
        <projectService serviceInterface="org.rust.cargo.project.model.CargoProjectsService"
                        serviceImplementation="org.rust.cargo.project.model.impl.CargoProjectsServiceImpl"
                        testServiceImplementation="org.rust.cargo.project.model.impl.TestCargoProjectsServiceImpl"/>

        <projectService serviceInterface="org.rust.lang.core.crate.CrateGraphService"
                        serviceImplementation="org.rust.lang.core.crate.impl.CrateGraphServiceImpl"/>

        <toolWindow id="Cargo"
                    anchor="right"
                    factoryClass="org.rust.cargo.project.toolwindow.CargoToolWindowFactory"
                    icon="/icons/tool-window.svg"/>

        <additionalLibraryRootsProvider
                implementation="org.rust.cargo.project.workspace.RsAdditionalLibraryRootsProvider"/>

        <!-- Icon Provider -->

        <fileIconProvider implementation="org.rust.cargo.icons.CargoIconProvider"/>
        <iconProvider implementation="org.rust.ide.icons.RsIconProvider"/>

        <!-- Indices -->

        <stubIndex implementation="org.rust.lang.core.stubs.index.RsModulesIndex"/>
        <stubIndex implementation="org.rust.lang.core.stubs.index.RsNamedElementIndex"/>
        <stubIndex implementation="org.rust.lang.core.stubs.index.RsGotoClassIndex"/>
        <stubIndex implementation="org.rust.lang.core.stubs.index.RsReexportIndex"/>
        <stubIndex implementation="org.rust.lang.core.stubs.index.RsExternCrateReexportIndex"/>
        <stubIndex implementation="org.rust.lang.core.stubs.index.RsFeatureIndex"/>
        <stubIndex implementation="org.rust.lang.core.stubs.index.RsCfgNotTestIndex"/>
        <stubIndex implementation="org.rust.lang.core.stubs.index.RsIncludeMacroIndex"/>

        <stubIndex implementation="org.rust.lang.core.resolve.indexes.RsImplIndex"/>
        <stubIndex implementation="org.rust.lang.core.resolve.indexes.RsTypeAliasIndex"/>
        <stubIndex implementation="org.rust.lang.core.resolve.indexes.RsLangItemIndex"/>
        <stubIndex implementation="org.rust.lang.core.resolve.indexes.RsMacroIndex"/>
        <stubIndex implementation="org.rust.lang.core.resolve.indexes.RsMacroCallIndex"/>

        <!-- Notifications -->

        <editorNotificationProvider implementation="org.rust.ide.notifications.MissingToolchainNotificationProvider"/>
        <editorNotificationProvider implementation="org.rust.ide.notifications.NoCargoProjectNotificationProvider"/>

        <notificationGroup id="Rust Plugin" displayType="BALLOON"/>
        <notificationGroup id="Rust Build Log" displayType="NONE"/>

        <!-- Editor Tab Title Providers -->

        <editorTabTitleProvider implementation="org.rust.ide.miscExtensions.RsFileTabTitleProvider"/>

        <!-- Refactoring -->

        <lang.namesValidator language="Rust" implementationClass="org.rust.ide.refactoring.RsNamesValidator"/>

        <inlineActionHandler implementation="org.rust.ide.refactoring.inlineFunction.RsInlineFunctionHandler"/>
        <inlineActionHandler implementation="org.rust.ide.refactoring.inlineValue.RsInlineValueHandler"/>

        <!-- Postfix templates -->
        <codeInsight.template.postfixTemplateProvider language="Rust"
                                                      implementationClass="org.rust.ide.template.postfix.RsPostfixTemplateProvider"/>

        <!-- Highlight Visitor -->

        <highlightVisitor implementation="org.rust.ide.highlight.RsRainbowVisitor"/>

        <!-- Move Actions -->

        <moveLeftRightHandler language="Rust" implementationClass="org.rust.ide.actions.RsMoveLeftRightHandler"/>
        <!--NB: order is important here-->
        <statementUpDownMover implementation="org.rust.ide.actions.mover.RsCommaListElementUpDownMover"/>
        <statementUpDownMover implementation="org.rust.ide.actions.mover.RsMatchArmUpDownMover"/>
        <statementUpDownMover implementation="org.rust.ide.actions.mover.RsStatementUpDownMover"/>
        <statementUpDownMover implementation="org.rust.ide.actions.mover.RsItemUpDownMover"/>

        <!-- Run Anything -->

        <runAnything.executionProvider order="after RunAnythingRunConfigurationProvider"
                                       implementation="org.rust.ide.actions.runAnything.cargo.CargoRunAnythingProvider"/>
        <runAnything.executionProvider order="after RunAnythingRunConfigurationProvider"
                                       implementation="org.rust.ide.actions.runAnything.wasmpack.WasmPackRunAnythingProvider"/>

        <lang.elementManipulator forClass="org.rust.lang.core.psi.RsLitExpr"
                                 implementationClass="org.rust.ide.injected.RsStringLiteralManipulator"/>
        <multiHostInjector implementation="org.rust.ide.injected.RsRegExpInjector"/>
        <multiHostInjector implementation="org.rust.ide.injected.RsDoctestLanguageInjector"/>


        <!-- Macro expansion service -->

        <projectService serviceInterface="org.rust.lang.core.macros.MacroExpansionManager"
                        serviceImplementation="org.rust.lang.core.macros.MacroExpansionManagerImpl"/>
        <indexedRootsProvider implementation="org.rust.lang.core.macros.RsIndexableSetContributor"/>
        <writingAccessProvider implementation="org.rust.lang.core.macros.RsMacroExpansionWritingAccessProvider"/>
        <cachesInvalidator implementation="org.rust.lang.core.macros.RsMacroExpansionCachesInvalidator"/>
        <virtualFileSystem key="rust_macros" implementationClass="org.rust.lang.core.macros.MacroExpansionFileSystem"/>
        <fileTypeOverrider implementation="org.rust.lang.core.macros.RsFileTypeOverriderForMacroExpansionFileSystem"/>
        <globalIndexFilter implementation="org.rust.lang.core.macros.RsGlobalIndexFilterForMacroExpansionFileSystem"/>
        <filetype.prebuiltStubsProvider filetype="Rust"
                                        implementationClass="org.rust.lang.core.macros.MacroExpansionStubsProvider"/>

        <!-- REPL Console -->

        <projectService serviceImplementation="org.rust.ide.console.RsConsoleOptions"/>

        <consoleHistoryModelProvider implementation="org.rust.ide.console.RsConsoleHistoryModelProvider"/>
        <scratch.rootType implementation="org.rust.ide.console.RsConsoleRootType"/>

        <!-- Listeners -->

        <fileDocumentManagerListener implementation="org.rust.cargo.RustfmtWatcher$RustfmtListener"/>

        <!-- Statistics -->
        <fileTypeStatisticProvider implementation="org.rust.ide.statistics.RsFileTypeStatisticProvider"/>

        <!-- Registry keys -->

        <registryKey key="org.rust.lang.type.alias.threshold" defaultValue="10" restartRequired="false"
                     description="Maximum number of type aliases to take into account during `impl`s search (old resolve)"/>
        <registryKey key="org.rust.lang.type.alias.threshold.new.resolve" defaultValue="2147483647" restartRequired="false"
                     description="Maximum number of type aliases to take into account during `impl`s search (new resolve)"/>
        <registryKey key="org.rust.lang.cfg.attributes" defaultValue="true" restartRequired="false"
                     description="Enable Rust cfg attributes support"/>
        <registryKey key="org.rust.lang.highlight.macro.body" defaultValue="true" restartRequired="false"
                     description="Highlight Rust macro call bodies"/>
        <registryKey key="org.rust.lang.macros.persistentCache" defaultValue="true" restartRequired="false"
                     description="Use persistent cache for Rust macro expansions"/>
        <registryKey key="org.rust.cargo.lock.update.delay.threshold" defaultValue="5000" restartRequired="false"
                     description="Delay in ms between Cargo metadata call and changes in Cargo.lock
                     when automatic project structure reload doesn't occur"/>
        <registryKey key="org.rust.cargo.evaluate.build.scripts.wrapper" defaultValue="true" restartRequired="false"
                     description="Use RUSTC_WRAPPER when fetching build script info (if experimental feature
                     `org.rust.cargo.evaluate.build.scripts` is enabled)"/>
        <registryKey key="org.rust.macros.proc.timeout" defaultValue="5000" restartRequired="false"
                     description="The maximum time (in milliseconds) allotted to one procedural macro expansion"/>

        <!-- Move refactoring -->

        <!--
            `before kotlin.moveFilesOrDirectories` is needed because otherwise
            incorrect handler can be used: https://youtrack.jetbrains.com/issue/IDEA-237769
        -->
        <refactoring.moveHandler id="rust.moveFilesOrDirectories"
                                 implementation="org.rust.ide.refactoring.move.RsMoveFilesOrDirectoriesHandler"
                                 order="first, before moveJavaFileOrDir, before kotlin.moveFilesOrDirectories"/>

        <refactoring.moveHandler id="rust.moveTopLevelItems"
                                 implementation="org.rust.ide.refactoring.move.RsMoveTopLevelItemsHandler"
                                 order="first, before moveJavaFileOrDir, before kotlin.moveFilesOrDirectories, before rust.moveFilesOrDirectories"/>

        <console.folding implementation="org.rust.ide.console.RsConsoleFolding"/>

        <!--  Experimental features -->
        <experimentalFeature id="org.rust.cargo.features.settings.gutter" percentOfUsers="0">
            <description>Show settings gutter icon near [features] section in `Cargo.toml` where you can enable or disable all features</description>
        </experimentalFeature>

    </extensions>

    <extensions defaultExtensionNs="org.rust">

        <!-- Toolchains -->

        <toolchainProvider implementation="org.rust.cargo.toolchain.RsLocalToolchainProvider"/>
        <toolchainProvider implementation="org.rust.cargo.toolchain.wsl.RsWslToolchainProvider"/>

        <!-- Toolchain flavors -->

        <toolchainFlavor id="rust.rustupToolchainFlavor"
                         implementation="org.rust.cargo.toolchain.flavors.RustupToolchainFlavor"
                         order="first"/>

        <toolchainFlavor id="rust.sysPathToolchainFlavor"
                         implementation="org.rust.cargo.toolchain.flavors.RsSysPathToolchainFlavor"/>

        <toolchainFlavor id="rust.unixToolchainFlavor"
                         implementation="org.rust.cargo.toolchain.flavors.RsUnixToolchainFlavor"/>

        <toolchainFlavor id="rust.macToolchainFlavor"
                         implementation="org.rust.cargo.toolchain.flavors.RsMacToolchainFlavor"/>

        <toolchainFlavor id="rust.winToolchainFlavor"
                         implementation="org.rust.cargo.toolchain.flavors.RsWinToolchainFlavor"/>

        <toolchainFlavor id="rust.wslToolchainFlavor"
                         implementation="org.rust.cargo.toolchain.wsl.RsWslToolchainFlavor"/>

    </extensions>

    <extensionPoints>
        <extensionPoint qualifiedName="org.rust.runConfigurationExtension"
                        interface="org.rust.cargo.runconfig.CargoCommandConfigurationExtension"
                        dynamic="true"/>
        <extensionPoint qualifiedName="org.rust.toolchainProvider"
                        interface="org.rust.cargo.toolchain.RsToolchainProvider"
                        dynamic="true"/>
        <extensionPoint qualifiedName="org.rust.toolchainFlavor"
                        interface="org.rust.cargo.toolchain.flavors.RsToolchainFlavor"
                        dynamic="true"/>
    </extensionPoints>

    <applicationListeners>
        <listener class="org.rust.ide.navigation.goto.RsGoToDeclarationRunningService$Listener"
                  topic="com.intellij.openapi.actionSystem.ex.AnActionListener" />
        <listener class="org.rust.ide.dynamic.RsDynamicPluginListener"
                  topic="com.intellij.ide.plugins.DynamicPluginListener" />
    </applicationListeners>

    <projectListeners>
        <listener class="org.rust.lang.core.macros.MacroExpansionManagerWaker"
                  topic="org.rust.cargo.project.model.CargoProjectsService$CargoProjectsListener" />
    </projectListeners>

    <actions>
        <action id="Rust.NewRustFile"
                class="org.rust.ide.actions.RsCreateFileAction">
            <add-to-group group-id="NewGroup" anchor="before" relative-to-action="NewFile"/>
        </action>

        <action id="Rust.NewCargoCrate"
                class="org.rust.ide.actions.RsCreateCrateAction"
                icon="/icons/cargo.svg">
            <add-to-group group-id="NewGroup" anchor="before" relative-to-action="NewFile"/>
        </action>

        <action id="Rust.Build"
                class="org.rust.ide.actions.RsBuildAction"
                icon="AllIcons.Actions.Compile"
                use-shortcut-of="CompileDirty">
            <add-to-group group-id="ToolbarRunGroup" relative-to-action="RunConfiguration" anchor="before"/>
            <add-to-group group-id="TouchBarDefault" relative-to-action="RunConfiguration" anchor="before"/>
        </action>

        <action id="Rust.RsPromoteModuleToDirectoryAction"
                class="org.rust.ide.refactoring.RsPromoteModuleToDirectoryAction">
            <add-to-group group-id="RefactoringMenu"/>
        </action>

        <action id="Rust.RsDowngradeModuleToFile"
                class="org.rust.ide.refactoring.RsDowngradeModuleToFile">
            <add-to-group group-id="RefactoringMenu"/>
        </action>

        <action id="Rust.RsConvertToNamedFields"
                class="org.rust.ide.refactoring.convertStruct.RsConvertToNamedFieldsAction">
            <add-to-group group-id="RefactoringMenu"/>
        </action>

        <action id="Rust.RsConvertToTuple"
                class="org.rust.ide.refactoring.convertStruct.RsConvertToTupleAction">
            <add-to-group group-id="RefactoringMenu"/>
        </action>

        <action id="Rust.RsExtractEnumVariant"
                class="org.rust.ide.refactoring.extractEnumVariant.RsExtractEnumVariantAction">
            <add-to-group group-id="IntroduceActionsGroup" anchor="after" relative-to-action="ExtractMethod"/>
        </action>

        <action id="Rust.ShowSingleStepMacroExpansionAction"
                class="org.rust.ide.actions.macroExpansion.RsShowSingleStepMacroExpansionAction">
        </action>
        <action id="Rust.ShowRecursiveMacroExpansionAction"
                class="org.rust.ide.actions.macroExpansion.RsShowRecursiveMacroExpansionAction">
        </action>

        <action class="org.rust.ide.refactoring.generate.constructor.GenerateConstructorAction"
                id="Rust.GenerateConstructor">
            <add-to-group group-id="GenerateGroup"/>
        </action>

        <action class="org.rust.ide.refactoring.generate.getter.GenerateGetterAction"
                id="Rust.GenerateGetter">
            <add-to-group group-id="GenerateGroup"/>
        </action>

        <action class="org.rust.ide.refactoring.generate.setter.GenerateSetterAction"
                id="Rust.GenerateSetter">
            <add-to-group group-id="GenerateGroup"/>
        </action>

        <action id="Rust.ReexpandMacrosAction"
                class="org.rust.lang.core.macros.ReexpandMacrosAction">
        </action>

        <action id="Rust.RebuildAllDefMaps"
                class="org.rust.lang.core.resolve2.actions.RsRebuildAllDefMapsAction">
        </action>

        <action id="Rust.RebuildCurrentDefMap"
                class="org.rust.lang.core.resolve2.actions.RsRebuildCurrentDefMapAction">
        </action>

        <action id="Rust.CreateNewGithubIssue"
                class="org.rust.ide.actions.diagnostic.CreateNewGithubIssue"
                icon="/icons/rust.svg">
            <add-to-group group-id="HelpMenu" anchor="after" relative-to-action="ReportProblem"/>
        </action>

        <action id="Rust.ShareInPlayground"
                class="org.rust.ide.actions.ShareInPlaygroundAction"/>

        <!-- Cargo-->

        <action id="Cargo.RustfmtFile"
                class="org.rust.ide.actions.RustfmtFileAction"
                icon="AllIcons.Actions.RealIntentionBulb">
            <add-to-group group-id="CodeMenu" anchor="last"/>
        </action>

        <action id="Cargo.RustfmtCargoProject"
                class="org.rust.ide.actions.RustfmtCargoProjectAction"
                icon="AllIcons.Actions.RealIntentionBulb">
            <add-to-group group-id="CodeMenu" anchor="last"/>
        </action>

        <action id="Cargo.RefreshCargoProject"
                class="org.rust.ide.actions.RefreshCargoProjectsAction"
                icon="AllIcons.Actions.Refresh"/>

        <action id="Cargo.AttachCargoProject"
                class="org.rust.cargo.project.model.AttachCargoProjectAction"
                icon="AllIcons.General.Add"/>

        <action id="Cargo.DetachCargoProject"
                class="org.rust.cargo.project.model.DetachCargoProjectAction"
                icon="AllIcons.General.Remove"
                use-shortcut-of="$Delete"/>

        <action id="Cargo.RunCargoCommand"
                class="org.rust.cargo.runconfig.command.RunCargoCommandAction"
                icon="/icons/cargo.svg"/>

        <action id="Cargo.RunExternalLinter"
                class="org.rust.ide.actions.RsRunExternalLinterAction"
                icon="/icons/external-linter.svg"/>

        <action id="Cargo.ToggleExternalLinterOnTheFlyAction"
                class="org.rust.ide.actions.ToggleExternalLinterOnTheFlyAction"/>

        <action id="Cargo.ShowSettings"
                class="org.rust.ide.actions.CargoEditSettingsAction"
                icon="AllIcons.General.Settings">
        </action>

        <group id="Rust.Cargo">
            <reference id="Cargo.RefreshCargoProject"/>
            <reference id="Cargo.AttachCargoProject"/>
            <reference id="Cargo.DetachCargoProject"/>
            <separator/>
            <reference id="Cargo.RunCargoCommand"/>
            <reference id="Cargo.RunExternalLinter"/>
            <reference id="Cargo.RustfmtCargoProject"/>
            <separator/>
            <reference id="ExpandAll"/>
            <reference id="CollapseAll"/>
            <separator/>
            <reference id="Cargo.ShowSettings"/>
        </group>

        <group id="Rust.ProjectView">
            <reference id="Cargo.AttachCargoProject"/>
            <add-to-group group-id="ProjectViewPopupMenu"/>
        </group>

        <action id="Rust.ConsoleREPL"
                class="org.rust.ide.console.RunRustConsoleAction"
                icon="/icons/repl.svg">
        </action>

        <group id="Rust.Tools"
               class="org.rust.ide.actions.RsToolsActionGroup"
               icon="/icons/rust.svg"
               popup="true">
            <group id="Rust.MacroExpansionActions"
                   class="org.rust.ide.actions.macroExpansion.RsShowMacroExpansionGroup">
                <reference id="Rust.ShowRecursiveMacroExpansionAction"/>
                <reference id="Rust.ShowSingleStepMacroExpansionAction"/>
                <separator/>
            </group>

            <reference id="Cargo.RustfmtFile"/>
            <reference id="Cargo.RustfmtCargoProject"/>
            <reference id="Rust.ConsoleREPL"/>
            <reference id="Rust.ShareInPlayground"/>

            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
            <add-to-group group-id="EditorTabPopupMenu" anchor="last"/>
        </group>

        <!-- Internal -->

        <action id="Rust.GenerateDictionaries"
                class="org.rust.ide.spelling.RsSpellCheckerGenerateDictionariesAction"
                internal="true">
            <add-to-group group-id="Internal"/>
        </action>

        <action id="Rust.ToggleNewResolve"
                class="org.rust.lang.core.resolve2.actions.RsToggleNewResolveAction"
                internal="true">
        </action>

    </actions>

</idea-plugin>
